% Summary of the parameters
m = 0.314;  %   mass of the pendulum
L = 0.64;   %   Length of the rod
d = 0.05;   %   coefficient of viscous friction
g = -9.81;   %   acceleration by gravity
mu = 0.05;  %   coefficient of viscous friction

%--------------------------------------------------------------
%--------------------------------------------------------------

% Simplified terms

I = (m*L^2)/12;  %   moment of inertial mass
G = (I + m*L^2); %   The matrix denominator

%--------------------------------------------------------------
%--------------------------------------------------------------

% The matrix values

a = 0;
b = 1;
c = (m*g*L)/G;
d = -mu/G;

e = m*L/G;
f = (-mu*m*L)/G^2;

%--------------------------------------------------------------
%--------------------------------------------------------------

% The matrices

Ai = [a, b; c, d];
Bi = [e; f];
Ci = [1 0];
Di = 0;
%--------------------------------------------------------------
%--------------------------------------------------------------
aa = 0;
bb = 1;
cc = 0;
dd = (m*g*L)/G;
ee = (mu)/G;
ff = 0;
gg = 0;
hh = 0;
ii = 0;
%--------------------------------------------------------------
%--------------------------------------------------------------
xx = m*L/G;
yy = (-mu*m*L)/G^2;
zz = 1;
%--------------------------------------------------------------
%--------------------------------------------------------------

A = [aa, bb, cc; dd, -ee, ff; gg, hh, ii];
 
B = [xx; yy; zz];

C = [1, 0, 0];

D = 0;
%--------------------------------------------------------------
%--------------------------------------------------------------

PX =  2 * [-1.1 -1.2 -1.3]; %

GAIN_K = place(A, B, PX); %

%--------------------------------------------------------------
%--------------------------------------------------------------

PY = 7 * [-1 -1.1]; %

Li = place(Ai, Ci' ,PY);

% LT = Li';

%--------------------------------------------------------------
%--------------------------------------------------------------

timeStep = 0.02;    % time steps for integration

totalTime = 10-0.02;      % total time for simulation

tspan = 0:timeStep:totalTime;   % build timepoint vector

%--------------------------------------------------------------
%--------------------------------------------------------------

% x0 = [-0.2; 0; 0];     % model introduces slight amount of noise so it will not stay balanced.

%[ -0.2 = rod angle; ]
%[    1 = cart velocity; ]
%[    0 = cart position ]

x0 = [0; 1; 0];     % model introduces slight amount of noise so it will not stay balanced.

[y, t, X_OUT] = POSITIONAL_STATE(A, B, C, D, GAIN_K, Li, tspan, x0);

%--------------------------------------------------------------
% for all time point animate the results
range=1;
len = length(tspan);
kickFlag = zeros(1,len);
%--------------------------------------------------------------
% get variables
x = X_OUT(3, :);    % cart positon
%th = y(:, 1);
%--------------------------------------------------------------

thet = X_OUT(1, :);

TASK = 'TASK-9';

%th = transpose(the);   % pendulum angle

%--------------------------------------------------------------
%--------------------------------------------------------------

% animate pendulum

figure
AnimatePendulumCart(thet + pi,  x, 0.6, tspan, range, kickFlag, TASK); 

%--------------------------------------------------------------
%--------------------------------------------------------------

% plot the graph

figure
hold on
plot(t,X_OUT)

%--------------------------------------------------------------
%--------------------------------------------------------------

